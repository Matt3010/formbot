<!DOCTYPE html>
<html lang="en">
<head>
    <title>noVNC</title>
    <style>
        html, body { margin: 0; height: 100%; overflow: hidden; }
        body { display: flex; flex-direction: column; background: dimgrey; }
        #screen { flex: 1; overflow: hidden; }
    </style>
    <script type="module" crossorigin="anonymous">
        import RFB from './core/rfb.js';

        function readQueryVariable(name, defaultValue) {
            const match = document.location.href.match(
                new RegExp('.*[?&]' + name + '=([^&#]*)')
            );
            return match ? decodeURIComponent(match[1]) : defaultValue;
        }

        const host = readQueryVariable('host', window.location.hostname);
        const port = readQueryVariable('port', window.location.port);
        const password = readQueryVariable('password');
        const path = readQueryVariable('path', 'websockify');

        const proto = window.location.protocol === 'https:' ? 'wss' : 'ws';
        const url = `${proto}://${host}${port ? ':' + port : ''}/${path}`;

        const rfb = new RFB(document.getElementById('screen'), url, {
            credentials: { password }
        });

        // Scale to fit container â€” do NOT use resizeSession (x11vnc+Xvfb can't resize)
        rfb.scaleViewport = true;
        rfb.resizeSession = false;

        // Re-apply after connect for reliability
        rfb.addEventListener('connect', () => {
            rfb.scaleViewport = true;
        });

        rfb.viewOnly = readQueryVariable('view_only', false);
    </script>
</head>
<body>
    <div id="screen"></div>
</body>
</html>
